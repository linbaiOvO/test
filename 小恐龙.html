<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥”è·‘å§ï¼å°æé¾™ - è½¯èŒä¿®å¤ç‰ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #fff0f5; /* è–°è¡£è‰çº¢èƒŒæ™¯ */
            font-family: 'Fredoka One', cursive, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 400px;
            background: linear-gradient(to bottom, #e0f7fa 0%, #fff0f5 100%);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* UI è¦†ç›–å±‚ */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            transition: opacity 0.2s;
            z-index: 10;
        }

        h1 {
            font-size: 40px;
            color: #ff6b81;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #fff;
        }

        p {
            color: #70a1ff;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.5;
        }

        .btn {
            background: #ff6b81;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 5px 15px rgba(255, 107, 129, 0.4);
            transition: transform 0.1s, background 0.2s;
            outline: none;
        }

        .btn:hover {
            background: #ff4757;
            transform: scale(1.05);
        }

        .btn:active {
            transform: scale(0.95);
        }

        #score-board {
            position: absolute;
            top: 20px;
            right: 30px;
            text-align: right;
            pointer-events: none;
            z-index: 5;
        }

        .score-text {
            font-size: 24px;
            color: #535c68;
            text-shadow: 1px 1px 0 #fff;
        }

        .high-score {
            font-size: 16px;
            color: #95afc0;
        }

        /* æš‚åœå›¾æ ‡ */
        #pause-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: #ff6b81;
            cursor: pointer;
            z-index: 5;
            background: rgba(255,255,255,0.5);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        @media (max-width: 600px) {
            #game-container {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
            h1 { font-size: 30px; }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="pause-icon" onclick="togglePause()">â¸</div>

        <div id="score-board">
            <div class="score-text">HI: <span id="highScoreVal">0</span></div>
            <div class="score-text" style="color: #ff6b81"><span id="currentScoreVal">0</span></div>
        </div>

        <div id="ui-layer">
            <h1 id="ui-title">ğŸ¦– å¥”è·‘å§ï¼å°æé¾™</h1>
            <p id="ui-desc">æŒ‰ [ç©ºæ ¼] æˆ– [ç‚¹å‡»å±å¹•] è·³è·ƒ<br>æŒ‰ [ESC] æš‚åœæ¸¸æˆ</p>
            <button id="ui-btn" class="btn" onclick="startGame()">å¼€å§‹æ‘¸é±¼</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const uiLayer = document.getElementById('ui-layer');
        const uiTitle = document.getElementById('ui-title');
        const uiDesc = document.getElementById('ui-desc');
        const uiBtn = document.getElementById('ui-btn');
        const scoreEl = document.getElementById('currentScoreVal');
        const highScoreEl = document.getElementById('highScoreVal');

        // --- æ¸¸æˆå¸¸é‡ (ç‰©ç†å‚æ•°å¾®è°ƒ) ---
        const GAME_SPEED_START = 6; 
        const GAME_SPEED_MAX = 18;
        const GRAVITY = 0.8;     // é‡åŠ›é€‚ä¸­
        const JUMP_FORCE = -13;  // è·³è·ƒåˆå§‹çˆ†å‘åŠ›
        
        // --- æ¸¸æˆçŠ¶æ€ ---
        let gameSpeed = GAME_SPEED_START;
        let score = 0;
        let highScore = localStorage.getItem('dinoHighScore') || 0;
        let isGameOver = false;
        let isPlaying = false;
        let isPaused = false;
        let frame = 0;
        let animationId = null;

        // å®ä½“
        let obstacles = [];
        let clouds = [];
        let particles = [];

        function resize() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        highScoreEl.innerText = Math.floor(highScore);

        // --- è¾“å…¥æ§åˆ¶ ---
        let keys = {};
        let jumpPressed = false; // è®°å½•è·³è·ƒé”®æ˜¯å¦è¢«æŒ‰ä¸‹ï¼ˆç”¨äºé•¿æŒ‰åˆ¤æ–­ï¼‰

        document.addEventListener('keydown', function (evt) {
            keys[evt.code] = true;
            
            // ç©ºæ ¼/ä¸Šç®­å¤´ï¼šè·³è·ƒæˆ–å¼€å§‹
            if (evt.code === 'Space' || evt.code === 'ArrowUp') {
                evt.preventDefault(); // é˜²æ­¢æ»šåŠ¨
                jumpPressed = true;
                if (!isPlaying && !isGameOver) startGame();
                else if (isGameOver) startGame();
            }
            
            // ä¸‹ç®­å¤´ï¼šä¸‹è¹²
            if (evt.code === 'ArrowDown') {
                evt.preventDefault();
            }

            // ESCï¼šæš‚åœ
            if (evt.code === 'Escape') {
                togglePause();
            }
        });

        document.addEventListener('keyup', function (evt) {
            keys[evt.code] = false;
            if (evt.code === 'Space' || evt.code === 'ArrowUp') {
                jumpPressed = false;
            }
        });

        // è§¦æ‘¸æ”¯æŒ
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            jumpPressed = true;
            keys['Space'] = true; // æ¨¡æ‹ŸæŒ‰é”®
            if (!isPlaying && !isGameOver) startGame();
            else if (isGameOver) startGame();
        }, {passive: false});

        canvas.addEventListener('touchend', function(e) {
            e.preventDefault();
            jumpPressed = false;
            keys['Space'] = false;
        });

        // --- æš‚åœåŠŸèƒ½ ---
        window.togglePause = function() {
            if (!isPlaying || isGameOver) return;

            isPaused = !isPaused;
            
            if (isPaused) {
                // æš‚åœçŠ¶æ€
                cancelAnimationFrame(animationId);
                uiLayer.style.opacity = 1;
                uiLayer.style.pointerEvents = 'auto';
                uiTitle.innerText = "ä¼‘æ¯ä¸€ä¸‹ â˜•";
                uiDesc.innerHTML = `å½“å‰å¾—åˆ†: ${Math.floor(score)}<br>ç‚¹å‡»æŒ‰é’®ç»§ç»­`;
                uiBtn.innerText = "ç»§ç»­å¥”è·‘";
                uiBtn.onclick = togglePause; // æŒ‰é’®åŠŸèƒ½æ”¹ä¸ºå–æ¶ˆæš‚åœ
            } else {
                // æ¢å¤æ¸¸æˆ
                uiLayer.style.opacity = 0;
                uiLayer.style.pointerEvents = 'none';
                uiBtn.onclick = startGame; // æ¢å¤æŒ‰é’®åŸæœ¬åŠŸèƒ½ï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
                animateLoop();
            }
        }

        // --- è§’è‰²ç±» ---
        class Dino {
            constructor() {
                this.w = 44;
                this.h = 48;
                this.x = 50;
                this.groundY = canvas.height - 150;
                this.y = this.groundY - this.h;
                
                this.dy = 0;
                this.originalH = 48;
                this.isDucking = false;
                this.grounded = true;
                this.color = '#ff6b81';
            }

            animate() {
                // 1. ä¸‹è¹²é€»è¾‘
                if (keys['ArrowDown'] || keys['KeyS']) {
                    this.h = this.originalH / 1.8;
                    this.isDucking = true;
                    // å¦‚æœåœ¨åœ°é¢ä¸”ä¸‹è¹²ï¼Œå¢åŠ ä¸‹å é€Ÿåº¦ï¼ˆå¿«é€Ÿè½åœ°ï¼‰
                    if (!this.grounded) this.dy += 2; 
                } else {
                    this.h = this.originalH;
                    this.isDucking = false;
                }

                // 2. è·³è·ƒé€»è¾‘ (æ ¸å¿ƒä¿®å¤)
                if (jumpPressed && this.grounded) {
                    this.dy = JUMP_FORCE;
                    this.grounded = false;
                    // ç‰¹æ•ˆ
                    spawnParticles(this.x + this.w/2, this.y + this.h, 5);
                }

                // å°è·³/å¤§è·³é€»è¾‘ï¼šå¦‚æœä¸­é€”æ¾å¼€è·³è·ƒé”®ï¼Œä¸”æ­£åœ¨ä¸Šå‡ï¼Œåˆ™å‰Šå‡ä¸Šå‡é€Ÿåº¦
                if (!jumpPressed && this.dy < 0) {
                    this.dy += 1.5; // å¿«é€Ÿæˆªæ–­è·³è·ƒé«˜åº¦
                }

                // 3. ç‰©ç†æ›´æ–°
                this.y += this.dy;

                // 4. åœ°é¢ç¢°æ’
                if (this.y + this.h < this.groundY) {
                    this.dy += GRAVITY;
                    this.grounded = false;
                } else {
                    this.dy = 0;
                    this.grounded = true;
                    this.y = this.groundY - this.h;
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                
                // æ ¹æ®ä¸‹è¹²è°ƒæ•´ç»˜åˆ¶ä½ç½®
                let drawY = this.y;
                if (this.isDucking) drawY = this.y + (this.originalH - this.h);

                // èº«ä½“
                roundRect(ctx, this.x, drawY, this.w, this.h, 10);

                // çœ¼ç›
                if (!this.isDucking) {
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(this.x + this.w - 12, drawY + 12, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'black';
                    ctx.beginPath();
                    ctx.arc(this.x + this.w - 10, drawY + 12, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // è…®çº¢
                    ctx.fillStyle = '#ff9ff3';
                    ctx.globalAlpha = 0.6;
                    ctx.beginPath();
                    ctx.arc(this.x + this.w - 18, drawY + 22, 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                } else {
                    // ä¸‹è¹²æ—¶çš„çœ¯çœ¯çœ¼
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(this.x + this.w - 12, drawY + 12, 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'black';
                    ctx.fillRect(this.x + this.w - 16, drawY + 11, 8, 2);
                }

                // è…¿éƒ¨åŠ¨ç”»
                if (this.grounded && gameSpeed > 0) {
                    ctx.fillStyle = '#e55066';
                    if (Math.floor(frame / 5) % 2 === 0) {
                        roundRect(ctx, this.x + 5, drawY + this.h - 4, 10, 8, 2);
                        roundRect(ctx, this.x + 25, drawY + this.h - 4, 10, 4, 2);
                    } else {
                        roundRect(ctx, this.x + 5, drawY + this.h - 4, 10, 4, 2);
                        roundRect(ctx, this.x + 25, drawY + this.h - 4, 10, 8, 2);
                    }
                }
            }
        }

        // --- éšœç¢ç‰©ç±» ---
        class Obstacle {
            constructor(gameSpeed) {
                this.x = canvas.width;
                this.groundY = canvas.height - 150;
                this.y = this.groundY;
                
                const typeVal = Math.random();
                this.type = 'cactus';

                if (score > 300 && typeVal > 0.7) {
                    // ç¿¼é¾™
                    this.type = 'bird';
                    this.w = 42;
                    this.h = 30;
                    // é«˜åº¦éšæœºï¼šä½(éœ€è·³) / é«˜(éœ€è¹²)
                    const hRand = Math.random();
                    if (hRand > 0.6) this.y -= 55; // é«˜é£ï¼ˆè¹²ï¼‰
                    else if (hRand > 0.3) this.y -= 20; // ä½é£ï¼ˆè·³ï¼‰
                    else this.y -= 90; // é£å¾—å¾ˆé«˜ï¼ˆè£…é¥°ï¼‰
                } else {
                    // ä»™äººæŒ
                    if (Math.random() > 0.5) {
                        this.w = 40; this.h = 50; // å¤§
                    } else {
                        this.w = 25; this.h = 35; // å°
                    }
                    this.y -= this.h;
                }
                
                this.markedForDeletion = false;
            }

            update() {
                this.x -= gameSpeed;
                if (this.x + this.w < -50) this.markedForDeletion = true;
            }

            draw() {
                if (this.type === 'cactus') {
                    ctx.fillStyle = '#2ed573';
                    roundRect(ctx, this.x, this.y, this.w, this.h, this.w/2);
                    ctx.fillStyle = '#7bed9f';
                    ctx.beginPath(); ctx.arc(this.x + 5, this.y + 10, 2, 0, Math.PI*2); ctx.fill();
                    ctx.beginPath(); ctx.arc(this.x + this.w - 5, this.y + 20, 2, 0, Math.PI*2); ctx.fill();
                } else {
                    // ç¿¼é¾™
                    ctx.fillStyle = '#70a1ff';
                    roundRect(ctx, this.x, this.y, this.w, this.h, 5);
                    // ç¿…è†€
                    ctx.fillStyle = '#a4c6ff';
                    const wingY = (Math.floor(frame / 10) % 2 === 0) ? -15 : 10;
                    ctx.beginPath();
                    ctx.moveTo(this.x + 10, this.y + 10);
                    ctx.lineTo(this.x + 20, this.y + 10 + wingY);
                    ctx.lineTo(this.x + 30, this.y + 10);
                    ctx.fill();
                    // çœ¼
                    ctx.fillStyle = 'white';
                    ctx.beginPath(); ctx.arc(this.x + 8, this.y + 8, 4, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = 'black';
                    ctx.beginPath(); ctx.arc(this.x + 8, this.y + 8, 1.5, 0, Math.PI*2); ctx.fill();
                }
            }
        }

        class Cloud {
            constructor() {
                this.x = canvas.width;
                this.y = Math.random() * 100 + 30;
                this.speed = Math.random() * 0.5 + 0.5;
                this.w = 60;
            }
            update() { this.x -= this.speed; }
            draw() {
                ctx.fillStyle = 'rgba(255,255,255,0.8)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 20, 0, Math.PI*2);
                ctx.arc(this.x + 25, this.y - 10, 25, 0, Math.PI*2);
                ctx.arc(this.x + 50, this.y, 20, 0, Math.PI*2);
                ctx.fill();
            }
        }

        class Particle {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.size = Math.random() * 5 + 2;
                this.speedX = Math.random() * 2 - 1;
                this.speedY = Math.random() * -2 - 1;
                this.color = `rgba(255, 255, 255, ${Math.random()})`;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.size *= 0.92;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill();
            }
        }

        // --- ä¸»é€»è¾‘ ---
        function roundRect(ctx, x, y, width, height, r) {
            if (width < 2 * r) r = width / 2;
            if (height < 2 * r) r = height / 2;
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.arcTo(x + width, y, x + width, y + height, r);
            ctx.arcTo(x + width, y + height, x, y + height, r);
            ctx.arcTo(x, y + height, x, y, r);
            ctx.arcTo(x, y, x + width, y, r);
            ctx.closePath();
            ctx.fill();
        }

        function spawnParticles(x, y, count) {
            for (let i = 0; i < count; i++) particles.push(new Particle(x, y));
        }

        let dino = new Dino();

        function startGame() {
            dino = new Dino();
            gameSpeed = GAME_SPEED_START;
            score = 0;
            isGameOver = false;
            isPaused = false;
            isPlaying = true;
            obstacles = [];
            clouds = [];
            particles = [];
            frame = 0;
            
            uiLayer.style.opacity = 0;
            uiLayer.style.pointerEvents = 'none';
            uiBtn.onclick = startGame;
            
            animateLoop();
        }

        function animateLoop() {
            if (!isPlaying) return;

            animationId = requestAnimationFrame(animateLoop);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            frame++;
            gameSpeed += 0.0015;
            if(gameSpeed > GAME_SPEED_MAX) gameSpeed = GAME_SPEED_MAX;
            score += 0.1;
            scoreEl.innerText = Math.floor(score);

            // èƒŒæ™¯
            if (frame % 150 === 0 && Math.random() > 0.5) clouds.push(new Cloud());
            clouds.forEach((c, i) => {
                c.update(); c.draw();
                if(c.x < -100) clouds.splice(i, 1);
            });

            // åœ°é¢çº¿
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 150 + 48);
            ctx.lineTo(canvas.width, canvas.height - 150 + 48);
            ctx.strokeStyle = "#dcdde1";
            ctx.lineWidth = 3;
            ctx.stroke();

            // æé¾™
            dino.animate();
            dino.draw();

            // éšœç¢ç‰©
            if (frame % 60 === 0) {
                let lastX = obstacles.length > 0 ? obstacles[obstacles.length-1].x : 0;
                if (canvas.width - lastX > 300 + Math.random() * 200) {
                    obstacles.push(new Obstacle(gameSpeed));
                }
            }

            obstacles.forEach((obs, index) => {
                obs.update();
                obs.draw();

                // ç¢°æ’ç›’å¾®è°ƒ (Hitbox)
                let paddingX = 10;
                let paddingY = 8;
                let dinoHitH = dino.isDucking ? dino.h : dino.h - 10; // ç«™ç«‹æ—¶å¤´éƒ¨åˆ¤å®šç¨å¾®å®½æ¾ç‚¹

                if (
                    dino.x < obs.x + obs.w - paddingX &&
                    dino.x + dino.w - paddingX > obs.x &&
                    dino.y + (dino.isDucking ? 0 : 10) < obs.y + obs.h - paddingY &&
                    dino.y + dinoHitH - paddingY > obs.y
                ) {
                    handleGameOver();
                }

                if (obs.markedForDeletion) obstacles.splice(index, 1);
            });

            // ç²’å­
            particles.forEach((p, i) => {
                p.update(); p.draw();
                if(p.size <= 0.2) particles.splice(i, 1);
            });
        }

        function handleGameOver() {
            isPlaying = false;
            isGameOver = true;
            cancelAnimationFrame(animationId);

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('dinoHighScore', highScore);
                highScoreEl.innerText = Math.floor(highScore);
            }

            // ç»˜åˆ¶å—ä¼¤çŠ¶æ€
            dino.color = '#a4b0be';
            dino.draw();

            uiTitle.innerText = "å“å‘€ï¼æ’åˆ°äº† QAQ";
            uiDesc.innerHTML = `æœ¬æ¬¡å¾—åˆ†: ${Math.floor(score)}<br>ç‚¹å‡»æŒ‰é’®å†æ¬¡å¥”è·‘`;
            uiBtn.innerText = "å†è¯•ä¸€æ¬¡";
            uiLayer.style.opacity = 1;
            uiLayer.style.pointerEvents = 'auto';
        }

        // åˆå§‹æ¸²æŸ“
        dino.draw();
    </script>
</body>
</html>